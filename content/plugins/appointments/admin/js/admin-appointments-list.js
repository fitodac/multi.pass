!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){AppointmentsAdmin=window.AppointmentsAdmin||{},function(e,t,i){"use strict";function n(e){function n(){i("#the-list .check-column :checked").length?i("#app-export-selected").show():i("#app-export-selected").hide()}var o={servicesPrice:[]};return this.options=i.extend({},o,e),this.isEditing=!1,this.$exportButton=i(".app-export_trigger"),this.$addNew=i(".add-new-h2"),this.$addNewSpinner=i(".add-new-waiting"),this.$editAppointment=i(".app-inline-edit"),this.$table=i("table.appointments"),i("#delete_removed").click(function(e){return confirm(t.deleteRecordsConfirm)}),this.$addNew.click(function(){this.$addNewSpinner.show(),this.removeActiveEditorForms(),this.showEditorForm(0,function(e){this.$table.prepend(e),this.$addNewSpinner.hide()})}.bind(this)),this.$editAppointment.click(function(e){var t=i(e.target).data("app-id"),n=i("#app-"+t),o=n.find(".waiting");o.show(),this.removeActiveEditorForms(),this.showEditorForm(t,function(e){o.hide(),n.hide(),n.after(e)})}.bind(this)),this.$table.on("click",".cancel",this.removeActiveEditorForms.bind(this)),this.$table.on("change",'select[name="service"]',function(e){var t=i(e.target),n=t.val();this.options.servicesPrice[n]&&t.parents(".inline-edit-col").find('input[name="price"]').val(this.options.servicesPrice[n])}.bind(this)),this.$table.on("click",".save",this.saveEditor.bind(this)),this.$table.on("change","select[name=worker]",this.fetchWorkerHours.bind(this)),this.$exportButton.click(function(e){var t=i(e.target),n=t.closest("form"),o=i(".column-delete.app-check-column :checked"),r=n.find("#app-export_type");return t.is("#app-export-selected")&&o.length?(o.each(function(){n.append("<input type='hidden' name='app[]' value='"+i(this).val()+"' />")}),r.val("selected"),!0):t.is("#app-export-type")?(n.append("<input type='hidden' name='status' value='"+t.attr("data-type")+"' />"),r.val("type"),!0):!!t.is("#app-export-all")&&(r.val("all"),!0)}),i(".app-change-status-btn").click(function(e){var t=i(this);return i("th.app-check-column input:checkbox:checked").each(function(){t.after('<input type="hidden" name="app[]" value="'+i(this).val()+'"/>')}),!0}),i(".info-button").click(function(){i(".status-description").toggle("fast")}),i(document).on("change",".check-column input, .app-column-cb input",n),i(n),this}n.prototype.removeActiveEditorForms=function(){this.$table.find(".inline-edit-row").hide(),i(".app-tr").show()},n.prototype.showEditorForm=function(e,n){var o={action:"inline_edit",col_len:this.options.columns,app_id:e,nonce:this.options.nonces.addNew,columns:this.options.columns};return i.post(ajaxurl,o,function(e){e&&e.error?alert(e.error):e&&"function"==typeof n?(n.call(this,[e.result]),this.initDatepicker()):alert(t.unexpectedError)}.bind(this),"json")},n.prototype.initDatepicker=function(){i(".datepicker").datepicker({dateFormat:"yy-mm-dd",firstDay:AppointmentsDateSettings.weekStart})},n.prototype.fetchWorkerHours=function(e){var n=i(e.target),o=n.val(),r=n.parents(".inline-edit-row"),a=r.find("select[name=service]").val(),s=r.find("select[name=location]"),p=r.find("select[name=time]"),c=p.val(),d=p.children("option:first"),l=r.find(".waiting"),u={};l.show(),u.nonce=this.options.nonces.editApp,u.action="inline_fetch_worker_slots",u.worker_id=o,u.app_id=a,u.selected_slot=c,void 0!==s&&(u.location_id=s.val()),i.post(ajaxurl,u,function(e){if(l.hide(),e&&e.error){var o=i("<div />",{class:"error"}).html(e.error);return n.after(o),void o.delay(1e4).fadeOut("slow")}if(!e)return void alert(t.unexpectedError);var r=JSON.parse(e.message);p.empty().append('<option value="'+d.val()+'">'+d.text()+"</option>");for(var a in r)p.append(r[a])}.bind(this),"json")},n.prototype.saveEditor=function(e){var n=i(e.target),o=n.parents(".inline-edit-row"),r=o.find(".waiting");r.show();var a=["user","cname","email","phone","address","city","service","worker","price","date","time","note","status"],s={};i.map(a,function(e){"cname"===e?s.name=o.find('[name="'+e+'"]').val():s[e]=o.find('[name="'+e+'"]').val()});var p=n.data("app-id"),c=o.find(".cancel");s.app_id=p,s.resend=o.find('input[name="resend"]').is(":checked")?1:0,s.nonce=this.options.nonces.editApp,s.action="inline_edit_save",i(document).trigger("app-appointment-inline_edit-save_data",[s,o]),i.post(ajaxurl,s,function(e){return r.hide(),e&&e.error?void o.find(".error").html(e.error).show().delay(1e4).fadeOut("slow"):e?(o.find(".error").html(e.message).show().delay(1e4).fadeOut("slow"),p&&parseInt(p,10)||!e||!e.app_id||location.reload(),e.reload&&location.reload(),void(c[0].innerHTML="Close")):void alert(t.unexpectedError)}.bind(this),"json")},e.appointmentsList=function(e){return new n(e)}}(AppointmentsAdmin,Appi18n,jQuery)}]);
//# sourceMappingURL=admin-appointments-list.js.map