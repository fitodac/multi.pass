!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";var n=i(1);n.keys().forEach(function(e){n(e)})},function(e,t,i){var n={"./js/script.js":2,"./sass/styles.scss":4};function o(e){return i(a(e))}function a(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}o.keys=function(){return Object.keys(n)},o.resolve=a,e.exports=o,o.id=1},function(e,t,i){window.jQuery;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};new(function(e){return e&&e.__esModule?e:{default:e}}(i(3)).default);wpmdb.mst={remote_mst_unavailable:!1},function(e,t){var i=e(".mst-options"),o=e("#mst-select-subsite"),a=e(".mst-options .expandable-content"),s=e("#mst-selected-subsite"),r=e(".new-prefix-field"),l=e("#new-prefix"),c=e("#new-prefix-hidden"),_=e("#new-prefix-readonly"),p=e(".mst-unavailable"),d=e(".mst-different-plugin-version-notice"),m=e(".mst-different-prefix-notice"),u=!1,b=null,f=!1,h=e(".table-select-wrap .table-prefix").text();function w(){return!("1"!==o.attr("data-available")||!o.is(":checked"))}function g(){return"true"===wpmdb_data.site_details.is_multisite}function v(){return void 0!==t.mst.remote_connection_data&&void 0!==t.mst.remote_connection_data.site_details&&void 0!==t.mst.remote_connection_data.site_details.is_multisite&&"true"===t.mst.remote_connection_data.site_details.is_multisite}function y(){e.wpmdb.do_action("wpmdb_lock_replace_url",!1),e.wpmdb.do_action("wpmdb_enable_table_migration_options"),o.attr("data-available","0"),o.prop("checked",!1),o.attr("disabled","disabled"),e(".mst").addClass("disabled"),a.hide()}function x(n){if(-1!==e.inArray(t.functions.wpmdb_migration_type(),["savefile","find_replace"])&&!g())return y(),void i.hide();if("import"===t.functions.wpmdb_migration_type())return y(),void i.hide();if(u&&(void 0!==t.mst.remote_connection_data||-1===e.inArray(t.migration_selection,["push","pull"]))){if(!g()&&!v())return y(),void i.hide();if(g()&&v())return y(),void i.hide();if("savefile"!==t.functions.wpmdb_migration_type()&&!1===n&&void 0!==t.mst.remote_connection_data&&void 0!==t.mst.remote_connection_data.site_details&&wpmdb_data.site_details.prefix!==t.mst.remote_connection_data.site_details.prefix)return y(),A(!1),e(".mst-remote-location").html(t.mst.remote_connection_data.url),e(".mst-remote-prefix").html(t.mst.remote_connection_data.site_details.prefix),void m.show();if(m.hide(),n&&"savefile"!==t.functions.wpmdb_migration_type())return y(),A(!1),void p.show();if(p.hide(),"savefile"!==t.functions.wpmdb_migration_type()&&void 0!==t.mst.remote_connection_data&&wpmdb_data.mst_version!==t.mst.remote_connection_data.mst_version)return y(),A(!1),e(".mst-remote-location").html(t.mst.remote_connection_data.url),e(".mst-remote-version").html(t.mst.remote_connection_data.mst_version),void d.show();d.hide(),o.attr("data-available","1"),o.removeAttr("disabled"),e(".mst").removeClass("disabled"),w()?(a.show(),$()):a.hide(),k(),i.show()}}function k(){w()&&-1===e.inArray(t.functions.wpmdb_migration_type(),["savefile","find_replace"])?e.wpmdb.do_action("wpmdb_lock_replace_url",!0):e.wpmdb.do_action("wpmdb_lock_replace_url",!1)}function F(){g()||v()?e.wpmdb.do_action("wpmdb_pin_replace_url",!0):e.wpmdb.do_action("wpmdb_pin_replace_url",!1)}function j(){return"pull"===t.functions.wpmdb_migration_type()&&g()||"push"===t.functions.wpmdb_migration_type()&&v()}function C(){if(""!==s.val()){if("savefile"!==t.functions.wpmdb_migration_type()){l.hide(),_.show(),r.children("label").addClass("disabled");var e=h,i=S();j()&&void 0!==i.blog_id&&1<i.blog_id&&(e=e+i.blog_id+"_"),l.val(e),c.val(e),_.text(e)}else l.show(),_.hide(),r.children("label").removeClass("disabled");r.show()}else r.hide()}function S(){var e={};if(w()){var t=s.find("option:selected").val();""===t&&(t=function(){var e="";void 0===wpmdb_data.mst_selected_subsite||isNaN(wpmdb_data.mst_selected_subsite)||(e=wpmdb_data.mst_selected_subsite);return e}()),""===t?e=!1:(e.blog_id=t,e.domain_and_path=s.find("option:selected").text())}return e}function $(i){var o=S();!function(i,o){e.wpmdb.do_action("wpmdb_refresh_table_selects"),void 0!==wpmdb_data.mst_selected_subsite&&"object"!==(void 0===o?"undefined":n(o))?u=!1:(u=!0,"pull"===t.functions.wpmdb_migration_type()?e.wpmdb.do_action("wpmdb_update_pull_table_select"):e.wpmdb.do_action("wpmdb_update_push_table_select"));z=i,w()?(e.wpmdb.do_action("wpmdb_disable_table_migration_options"),(u&&(!1===z||void 0!==z.blog_id&&void 0!==i.blog_id&&z.blog_id===i.blog_id)||"savefile"===t.migration_selection||"find_replace"===t.migration_selection)&&e.wpmdb.do_action("wpmdb_select_all_tables")):e.wpmdb.do_action("wpmdb_enable_table_migration_options")}(o,i),A(o),C()}var z=!1;function A(i){var n=b;if(void 0!==i&&"find_replace"!==t.functions.wpmdb_migration_type()){void 0!==i.domain_and_path&&(n="//"+i.domain_and_path);var o=!1;j()&&(o=!0),f&&(o=!o),o?e('.replace-row.pin .replace-right-col input[type="text"]').val(n):e('.replace-row.pin .old-replace-col input[type="text"]').val(n)}}function T(e,i){var n=S();if(void 0!==n.blog_id){if(!(1<n.blog_id)){var o=t.functions.preg_quote(i);return null===new RegExp(e+"([0-9]+)_","i").exec(o)}if(e=e+n.blog_id+"_",0===i.toLowerCase().indexOf(e.toLowerCase()))return!0}return!1}function D(e){t.mst.remote_connection_data=e,t.mst.remote_mst_unavailable=void 0===e.mst_available}function O(){!1!==w()&&v()&&(g()&&!v()?E(wpmdb_data.site_details.subsites):!g()&&v()&&E(t.mst.remote_connection_data.site_details.subsites))}function E(t){var i=S();e(s).empty(),e(s).append('<option value="">-- '+wpmdbmst_strings.select_subsite+" --</option>"),e.each(t,function(t,n){if(!e.wpmdb.apply_filters("wpmdb_exclude_subsite",!1,n)){var o=" ";!1!==i&&t===i.blog_id&&(o=' selected="selected" '),e(s).append("<option"+o+'value="'+t+'">'+n+"</option>")}})}e.wpmdb.add_action("move_connection_info_box",function(i){h=e(".table-select-wrap .table-prefix").text(),null===b&&(b=e.wpmdb.apply_filters("wpmdb_base_old_url")),void 0!==i.migration_type&&void 0!==i.last_migration_type&&(i.migration_type===i.last_migration_type||"pull"!==i.migration_type&&"pull"!==i.last_migration_type||(f=!0)),t.functions.wpmdb_toggle_migration_action_text(),x(t.mst.remote_mst_unavailable),e.wpmdb.do_action("wpmdb_refresh_table_selects"),f&&(f=!1)}),e.wpmdb.add_action("verify_connection_to_remote_site",function(e){D(e),u=!0,x(t.mst.remote_mst_unavailable)}),e.wpmdb.add_action("move_connection_info_box",F),e.wpmdb.add_action("move_connection_info_box",O),e.wpmdb.add_action("move_connection_info_box",function(i){void 0!==t.mst.remote_connection_data&&w()&&i.last_migration_type!==i.migration_type&&setTimeout(function(){e.wpmdb.do_action("wpmdb_select_all_tables")})}),e.wpmdb.add_action("wpmdb_connection_data_updated",D),e.wpmdb.add_action("wpmdb_connection_data_updated",F),e.wpmdb.add_action("wpmdb_connection_data_updated",O),e.wpmdb.add_filter("wpmdb_exclude_table",function(i,n){if(w()){if(!1===S())return!0;if(n.substr(0,h.length)!==h)return!0;if(1===t.functions.subsite_for_table(h,n)){if(t.functions.table_is(h,"users",n)||t.functions.table_is(h,"usermeta",n))return i;e.each(["blog_versions","blogs","registration_log","signups","site","sitemeta"],function(e,o){t.functions.table_is(h,o,n)&&(i=!0)})}if("pull"===t.functions.wpmdb_migration_type()&&!v())return i;if("push"===t.functions.wpmdb_migration_type()&&!g())return i;!1===T(h,n)&&(i=!0)}return i}),e.wpmdb.add_filter("wpmdb_migration_profile_ready",function(e,i){if(!1===w())return e;var n=l.val();return!1===S()?(alert(wpmdbmst_strings.please_select_a_subsite),e=!1):0===n.trim().length?(alert(wpmdbmst_strings.please_enter_a_prefix),e=!1):!1===function(e){var i=t.functions.preg_quote(e);return null===new RegExp("[^a-z0-9_]","i").exec(i)}(n)&&(alert(wpmdbmst_strings.new_prefix_contents),e=!1),e}),e.wpmdb.add_filter("wpmdb_backup_selected_tables",function(i){if(w()&&"find_replace"!==t.functions.wpmdb_migration_type()){var n=S();!(void 0!==n.blog_id&&1<n.blog_id)||g()&&v()||e.each(i,function(e,o){!1===t.table_is(h,"users",o)&&!1===t.table_is(h,"usermeta",o)&&(!1===T(h,o)&&j()&&(i[e]=l.val()+o.substr(h.length)),!0!==T(h,o)||j()||(i[e]=l.val()+o.substr((h+n.blog_id+"_").length)))})}return i}),e.wpmdb.add_filter("wpmdbmf_enable_select_subsites",function(e){return!1!==e&&w()&&(e=!1),e}),C(),e(document).ready(function(){e("body").on("change","#mst-select-subsite",function(t){!function(){var t=w();k(),e.wpmdb.do_action("wpmdbmst_select_subsite_changed",t),O(),$()}()}),e("body").on("change","#mst-selected-subsite",function(e){$(e)}),x(t.mst.remote_mst_unavailable)})}(jQuery,wpmdb)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var a=window.jQuery,s=window.ajaxurl,r=window.wpmdb_strings,l=window.wpmdb_data,c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.show_ssl_notice=!1,this.doing_save_profile=!1,this.doing_ajax=!1,this.profile_name_edited=!1,this.migration_intent=null,this.doing_licence_registration_ajax=!1,this.migration_paused=!1,this.last_replace_switch=wpmdb.functions.wpmdb_migration_type(),this.connection_established=!1,this.profile_name_edited=!1,this.checked_licence=!1,this.show_prefix_notice=!1,this.show_ssl_notice=!1,this.force_reconnect=!1,this.migration_selection="",this.show_version_notice=!1,this.migration_completed=!1,this.currently_migrating=!1,this.dump_filename="",this.dump_path="",this.migration_intent="",this.remote_site=null,this.secret_key=null,this.form_data=null,this.stage=null,this.elapsed_interval=null,this.completed_msg=null,this.tables_to_migrate=[],this.migration_paused=!1,this.previous_progress_title="",this.previous_progress_text_primary="",this.previous_progress_text_secondary="",this.cancelling_text="",this.paused_text="",this.migration_cancelled=!1,this.flag_skip_delay=!1,this.delay_between_requests=0,this.fade_duration=400,this.pause_before_finalize=!1,this.is_auto_pause_before_finalize=!1,this.$connection_info_box=a(".connection-info-wrapper"),this.$push_select=window.wpmdb.$push_select=a("#select-tables").clone(),this.$pull_select=window.wpmdb.$pull_select=a("#select-tables").clone(),this.$push_post_type_select=a("#select-post-types").clone(),this.$pull_post_type_select=a("#select-post-types").clone(),this.$push_select_backup=a("#select-backup").clone(),this.$pull_select_backup=a("#select-backup").clone(),this.spinner_url=window.spinner_url=wpmdb.functions.get_spinner_url(),this.ajax_spinner=window.ajax_spinner='<img src="'+this.spinner_url+'" alt="" class="ajax-spinner general-spinner" />'}return o(e,[{key:"pad",value:function(e,t,i){return i=i||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(i)+e}},{key:"is_int",value:function(e){return"number"==typeof(e=parseInt(e))&&0==e%1}},{key:"get_intersect",value:function(e,t){var i,n,o=[],a={},s=t.length;for(i=0;i<s;i++)a[t[i]]=!0;for(s=e.length,i=0;i<s;i++)(n=e[i])in a&&o.push(n);return o}},{key:"pin_replace_url",value:function(e){!0===e&&1>a(".replace-row.pin").length&&1===a("#old-url").length&&a("#old-url").parents(".replace-row").addClass("pin"),!1===e&&0<a(".replace-row.pin").length&&a(".replace-row.pin").removeClass("pin")}},{key:"get_ajax_errors",value:function(e,t,i){return wpmdb.functions.wpmdbGetAjaxErrors(r.connection_local_server_problem,t,e,i)}},{key:"refresh_debug_log",value:function(){a.ajax({url:s,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_get_log",nonce:l.nonces.get_log},error:function(e,t,i){alert(r.update_log_problem)},success:function(e){a(".debug-log-textarea").val(e)}})}},{key:"get_query_var",value:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}},{key:"maybe_show_ssl_warning",value:function(e,t,i){var n=e.substr(0,e.indexOf(":")),o=a(".ssl-notice");if(this.show_ssl_notice||o.hide(),i!==n&&-1!==e.indexOf("https"))return o.show(),this.show_ssl_notice=!0,e=e.replace("https","http"),void a(".pull-push-connection-info").val(e+"\n"+t);this.show_ssl_notice=!1}},{key:"validate_url",value:function(e){return/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}},{key:"refresh_table_selects",value:function(){void 0!==l&&void 0!==l.this_tables&&void 0!==l.this_table_sizes_hr&&(this.$push_select=this.create_table_select(l.this_tables,l.this_table_sizes_hr,a(wpmdb.$push_select).val())),void 0!==wpmdb.common.connection_data&&void 0!==wpmdb.common.connection_data.tables&&void 0!==wpmdb.common.connection_data.table_sizes_hr&&(this.$pull_select=this.create_table_select(wpmdb.common.connection_data.tables,wpmdb.common.connection_data.table_sizes_hr,a(wpmdb.$pull_select).val()))}},{key:"save_active_profile",value:function(){var e,t=this;if(a(".save-settings-button").blur(),!this.doing_save_profile&&!0!==this.maybe_show_select_table_notice()){var i=!1;a("#create_new").is(":checked")&&(i=!0);var n=a(".create-new-profile").val();this.doing_save_profile=!0,e=a(a("#migrate-form")[0].elements).not(".auth-credentials").serialize(),a(".save-settings-button").attr("disabled","disabled").after('<img src="'+this.spinner_url+'" alt="" class="save-profile-ajax-spinner general-spinner" />'),this.doing_ajax=!0,a.ajax({url:s,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_save_profile",profile:e,nonce:l.nonces.save_profile},error:function(e,i,n){t.doing_ajax=!1,alert(r.save_profile_problem),a(".save-settings-button").removeAttr("disabled"),a(".save-profile-ajax-spinner").remove(),a(".save-settings-button").after('<span class="ajax-success-msg">'+r.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()}),t.doing_save_profile=!1},success:function(e){var o=parseInt(a("#migrate-form input[name=save_migration_profile_option]:checked").val(),10)+1;if(t.doing_ajax=!1,a(".save-settings-button").removeAttr("disabled"),a(".save-profile-ajax-spinner").remove(),a(".save-settings-button").after('<span class="ajax-success-msg">'+r.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()}),t.doing_save_profile=!1,a(".create-new-profile").val(""),i){var s=parseInt(e,10),c=s+1,_=a('<li><span class="delete-profile" data-profile-id="'+c+'"></span><label for="profile-'+c+'"><input id="profile-'+c+'" value="'+s+'" name="save_migration_profile_option" type="radio"></label></li>');_.find("label").append(document.createTextNode(" "+n)),o=c,a("#create_new").parents("li").before(_),a("#profile-"+c).attr("checked","checked")}var p=window.location.href.replace("#migrate","").replace(/&wpmdb-profile=-?\d+/,"")+"&wpmdb-profile="+o,d=a("#migrate-form input[name=save_migration_profile_option]:checked").parent().text().trim();if("function"==typeof window.history.pushState){if(a("#migrate-form .crumbs").length)a("#migrate-form .crumbs .crumb:last").text(d);else{var m=a('<div class="crumbs" />').append('<a class="crumb" href="'+l.this_plugin_base+'"> Saved Profiles </a>').append('<span class="crumb">'+d+"</span>");a("#migrate-form").prepend(m)}window.history.pushState({updated_profile_id:o},null,p)}}})}}},{key:"cancel_migration",value:function(e){this.migration_cancelled=!0,this.cancelling_text=r.cancelling_migration,a(".migration-controls").css({visibility:"hidden"}),"find_replace"===this.migration_intent&&(this.cancelling_text=r.cancelling_find_replace),wpmdb.current_migration.setState(this.cancelling_text,r.completing_current_request,"cancelling"),!0===this.migration_paused&&(this.migration_paused=!1,wpmdb.functions.execute_next_step())}},{key:"set_checkbox",value:function(e){var t=a("#"+e),i=t.find("input[type=checkbox]");t.toggleClass("on").find("span").toggleClass("checked");var n=t.find("span.on").hasClass("checked");i.attr("checked",n).trigger("change")}},{key:"move_connection_info_box",value:function(){var e,t,i,n,o,s,r=a(".connection-status"),c=a(".directory-permission-notice"),_=a(".compatibility-older-mysql"),p=a(".mst-required"),d=a(".keep-active-plugins"),m=a(".step-two"),u=a(".backup-options"),b=wpmdb.functions.wpmdb_migration_type();if(r.hide(),c.hide(),m.show(),u.show(),d.show(),_.hide(),p.hide(),wpmdb.functions.wpmdb_toggle_migration_action_text(),a(".migrate-tab").attr("class","migrate-tab content-tab").addClass(wpmdb.functions.wpmdb_migration_type()),a.wpmdb.do_action("move_connection_info_box",{migration_type:b,last_migration_type:this.last_replace_switch}),-1!==a.inArray(b,["push","pull"])){var f=a(".pull-push-connection-info"),h=a.trim(f.val()).split("\n"),w=a("."+b+"-list li");if(w.append(this.$connection_info_box),this.$connection_info_box.show(function(){var e=a(this).find(".pull-push-connection-info");e.val()||e.focus()}),b!==this.last_replace_switch&&2===h.length)return wpmdb.force_reconnect=!0,w.append(this.$connection_info_box),f.removeClass("temp-disabled").attr("readonly","readonly"),a(".connect-button").hide(),void wpmdb.functions.connection_box_changed();this.connection_established?(r.hide(),m.show(),wpmdb.functions.wpmdb_toggle_migration_action_text(),"pull"===b?(t=wpmdb.common.connection_data.prefix,i=l.site_details.prefix,n=l.this_uploads_dir,o=l.this_upload_dir_long,s=l.write_permission):(t=l.this_prefix,i=wpmdb.common.connection_data.prefix,n=wpmdb.common.connection_data.uploads_dir,o=wpmdb.common.connection_data.upload_dir_long,s=wpmdb.common.connection_data.write_permissions),a(".table_prefix").html(t),a(".backup-table-prefix").html(i),a(".uploads-dir").html(n),this.maybe_show_backup_disabled_msg(o,s),!1===this.profile_name_edited&&(e=this.get_domain_name(wpmdb.common.connection_data.url),a(".create-new-profile").val(e))):(r.show(),m.hide())}else if(-1!==a.inArray(b,["find_replace","savefile"]))if(r.hide(),m.show(),a(".table-prefix").html(l.this_prefix),!1===this.profile_name_edited&&a(".create-new-profile").val(""),d.hide(),"savefile"===b)u.hide(),_.show(),"false"===l.write_permission&&(c.show(),m.hide());else{if("true"===l.is_multisite){var g=a(".old-replace-col").eq(1);g.parent().removeClass("pin").find(".replace-remove-row").show(),g.find("input").removeAttr("readonly")}this.maybe_show_backup_disabled_msg(l.this_upload_dir_long,l.write_permission)}this.maybe_show_mixed_cased_table_name_warning()}},{key:"maybe_show_backup_disabled_msg",value:function(e,t){var i=a("#create-backup"),n=a("#create-backup-label"),o=a(".backup-option-disabled");i.removeAttr("disabled"),n.removeClass("disabled"),o.hide(),"false"===t&&(i.prop("checked",!1),i.attr("disabled","disabled"),n.addClass("disabled"),o.show(),a(".upload-directory-location").html(e))}},{key:"change_replace_values",value:function(){var e=null,t=null;null!==wpmdb.common.previous_connection_data&&"object"===n(wpmdb.common.previous_connection_data)&&wpmdb.common.previous_connection_data.url!==wpmdb.common.connection_data.url&&(e=this.remove_protocol(wpmdb.common.previous_connection_data.url),t=wpmdb.common.previous_connection_data.path),"push"===wpmdb.functions.wpmdb_migration_type()||"savefile"===wpmdb.functions.wpmdb_migration_type()?("pull"===this.last_replace_switch?a(".replace-row").each(function(){var e=a(".old-replace-col input",this).val();a(".old-replace-col input",this).val(a(".replace-right-col input",this).val()),a(".replace-right-col input",this).val(e)}):"push"===this.last_replace_switch&&"push"===wpmdb.functions.wpmdb_migration_type()&&null!==e&&null!==t&&a(".replace-row").each(function(){var i=a(".replace-right-col input",this).val();i===t&&a(".replace-right-col input",this).val(wpmdb.common.connection_data.path),i===e&&a(".replace-right-col input",this).val(this.remove_protocol(wpmdb.common.connection_data.url))}),a.wpmdb.do_action("wpmdb_update_push_table_select"),a("#select-post-types").remove(),a(".exclude-post-types-warning").after(this.$push_post_type_select),wpmdb.functions.exclude_post_types_warning(),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(this.$push_select_backup)):"pull"===wpmdb.functions.wpmdb_migration_type()&&(""===this.last_replace_switch||"push"===this.last_replace_switch||"savefile"===this.last_replace_switch?a(".replace-row").each(function(){var e=a(".old-replace-col input",this).val();a(".old-replace-col input",this).val(a(".replace-right-col input",this).val()),a(".replace-right-col input",this).val(e)}):"pull"===this.last_replace_switch&&"pull"===wpmdb.functions.wpmdb_migration_type()&&null!==e&&null!==t&&a(".replace-row").each(function(){var i=a(".old-replace-col input",this).val();i===t&&a(".old-replace-col input",this).val(wpmdb.common.connection_data.path),i===e&&a(".old-replace-col input",this).val(this.remove_protocol(wpmdb.common.connection_data.url))}),a.wpmdb.do_action("wpmdb_update_pull_table_select"),a("#select-post-types").remove(),a(".exclude-post-types-warning").after(this.$pull_post_type_select),wpmdb.functions.exclude_post_types_warning(),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(this.$pull_select_backup)),this.last_replace_switch=wpmdb.functions.wpmdb_migration_type()}},{key:"switch_to_plugin_tab",value:function(e,t){a(".nav-tab").removeClass("nav-tab-active"),a(".nav-tab."+e).addClass("nav-tab-active"),a(".content-tab").hide(),a("."+e+"-tab").show(),"settings"===e&&!0===this.should_check_licence()&&(a("p.licence-status").append("Checking License... ").append(this.ajax_spinner),this.check_licence()),"help"===e&&(this.refresh_debug_log(),!0===this.should_check_licence()&&(a(".support-content p").append(this.ajax_spinner),this.check_licence())),"addons"===e&&!0!==t&&!0===this.should_check_licence()&&(a(".addons-content p").append(this.ajax_spinner),this.check_licence())}},{key:"hide_overlay",value:function(){a("#overlay").removeClass("show").addClass("hide"),a("#overlay > div").removeClass("show").addClass("hide"),wpmdb.current_migration.$proVersion.find("iframe").remove(),setTimeout(function(){a("#overlay").remove()},500),this.migration_completed=!1}},{key:"check_licence",value:function(e){var t=!this.doing_licence_registration_ajax;this.checked_licence=!0;var i=this;a.ajax({url:s,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_check_licence",licence:e,context:"all",nonce:l.nonces.check_licence},error:function(e,t,i){alert(r.license_check_problem)},success:function(e){var n,o,s,r=a(".support-content"),l=a(".addons-content"),c=a(".licence-status:not(.notification-message)");if(void 0!==e.dbrains_api_down)o=e.dbrains_api_down+e.message,s=e.dbrains_api_down;else if(void 0!==e.errors){if(void 0!==e.errors.subscription_expired)n=e.errors.subscription_expired.licence,o=e.errors.subscription_expired.support,s=e.errors.subscription_expired.addons;else{var _="";for(var p in e.errors)_+=e.errors[p];o=_,s=_}void 0!==e.addon_content&&(s+="\n"+e.addon_content)}else o=e.message,s=e.addon_content;t&&c.stop().fadeOut(i.fade_duration,function(){void 0===n&&(a(this).css({visibility:"hidden",display:"block"}).slideUp(),n=""),a(this).empty().html(n).stop().fadeIn(i.fade_duration)}),r.stop().fadeOut(i.fade_duration,function(){a(this).empty().html(o).stop().fadeIn(i.fade_duration)}),l.stop().fadeOut(i.fade_duration,function(){a(this).empty().html(s).stop().fadeIn(i.fade_duration)}),a("#plugin-compatibility").is(":not(:checked)")&&a("#compatibility-header").click()}})}},{key:"should_check_licence",value:function(){return!1===this.checked_licence&&"1"===l.has_licence&&"true"===l.is_pro}},{key:"maybe_show_mixed_cased_table_name_warning",value:function(){if(void 0!==wpmdb.common.connection_data&&!1!==wpmdb.common.connection_data){var e=wpmdb.functions.wpmdb_migration_type(),t=wpmdb.functions.get_tables_to_migrate(null,null);a(".mixed-case-table-name-notice").hide(),null!==t&&(t=t.join(""))!==t.toLowerCase()&&("1"===wpmdb.common.connection_data.lower_case_table_names||"push"!==e&&"savefile"!==e)&&("1"!==l.lower_case_table_names&&"pull"===e||("push"===e||"savefile"===e?a(".mixed-case-table-name-notice.push").show():a(".mixed-case-table-name-notice.pull").show()))}}},{key:"enable_pro_licence",value:function(e,t){a(".licence-input, .register-licence").remove(),a(".licence-not-entered").prepend(e.masked_licence),a(".support-content").empty().html("<p>"+r.fetching_license+'<img src="'+this.spinner_url+'" alt="" class="ajax-spinner general-spinner" /></p>'),this.check_licence(t),a(".migrate-selection label").removeClass("disabled"),a(".migrate-selection input").removeAttr("disabled")}},{key:"get_domain_name",value:function(e){return e.replace(/\/\/(.*)@/,"//").replace("http://","").replace("https://","").replace("www.","")}},{key:"update_domain_placeholder",value:function(e,t,i){var n=this.get_domain_name(t);return"completed"===i?e.replace(/\%s\s?/,"<span class=domain-label>"+n+"</span>&nbsp;"):e.replace(/\%s(\S*)\s?/,"<span class=domain-label>"+n+"$1</span>&nbsp;")}},{key:"get_migration_status_label",value:function(e,t,i){var n="",o="";switch(t){case"push":n=r.push_migration_label_migrating,o=r.push_migration_label_completed;break;case"pull":n=r.pull_migration_label_migrating,o=r.pull_migration_label_completed;break;case"find_replace":n=r.find_replace_label_migrating,o=r.find_replace_label_completed;break;case"savefile":n=r.exporting_please_wait,o=r.exporting_complete}var s=n;return"completed"===i&&(s=o),"push"!==t&&"pull"!==t||(s=this.update_domain_placeholder(s,e,i)),s=a.wpmdb.apply_filters("wpmdb_get_migration_status_label",s,{intent:t,stage:i})}},{key:"disable_export_type_controls",value:function(){a(".option-group").each(function(e){a("input",this).attr("disabled","disabled"),a("label",this).css("cursor","default")})}},{key:"enable_export_type_controls",value:function(){a(".option-group").each(function(e){a("input",this).removeAttr("disabled"),a("label",this).css("cursor","pointer")})}},{key:"set_slider_value",value:function(e,t,i,n){var o=t;void 0!==n&&(o=n),a(".slider",e).slider("value",parseInt(t)),a(".amount",e).html(wpmdb.functions.wpmdb_add_commas(o)+" "+i)}},{key:"set_pause_resume_button",value:function(e,t){!0===this.migration_paused?(this.migration_paused=!1,this.doing_ajax=!0,wpmdb.current_migration.setState(this.previous_progress_title,this.previous_progress_text_primary,"active"),a(".pause-resume").html(r.pause),wpmdb.current_migration.resumeTimer(),wpmdb.functions.execute_next_step(t)):(this.migration_paused=!0,this.doing_ajax=!1,this.paused_text=r.migration_paused,this.previous_progress_title=a(".progress-title").html(),this.previous_progress_text_primary=a(".progress-text",".progress-wrapper-primary").html(),this.previous_progress_text_secondary=a(".progress-text",".progress-wrapper-secondary ").html(),"find_replace"===this.migration_intent&&(this.paused_text=r.find_replace_paused),wpmdb.current_migration.setState(this.paused_text,r.completing_current_request,null),a("body").off("click",".pause-resume"),a("body").off("click",".cancel"))}},{key:"filter_temp_tables",value:function(e,t){var i=l.this_temp_prefix;return"pull"===wpmdb.functions.wpmdb_migration_type()&&void 0!==wpmdb.common.connection_data&&void 0!==wpmdb.common.connection_data.temp_prefix&&(i=wpmdb.common.connection_data.temp_prefix),i===t.substring(0,i.length)||e}},{key:"get_table_prefix",value:function(e,t){return a(".table-select-wrap .table-prefix").text()}},{key:"lock_replace_url",value:function(e){!0===e?(a('.replace-row.pin .replace-right-col input[type="text"]').attr("readonly","readonly"),a(".replace-row.pin .arrow-col").addClass("disabled")):(a('.replace-row.pin .replace-right-col input[type="text"]').removeAttr("readonly"),a(".replace-row.pin .arrow-col").removeClass("disabled"))}},{key:"set_connection_data",value:function(e){window.wpmdb.common.previous_connection_data=wpmdb.common.connection_data,window.wpmdb.common.connection_data=e,a.wpmdb.do_action("wpmdb_connection_data_updated",e)}},{key:"get_max_request_display_info",value:function(e){var t={unit:"MB"};return t.amount=(e/1024).toFixed(2),t}},{key:"establish_remote_connection_from_saved_profile",value:function(){var e=wpmdb.functions.wpmdb_migration_type(),t=a.trim(a(".pull-push-connection-info").val()).split("\n");if("undefined"!=typeof wpmdb_default_profile&&!0!==wpmdb_default_profile&&"savefile"!==e&&"find_replace"!==e&&"import"!==e&&!this.doing_ajax&&l.is_pro){this.doing_ajax=!0,this.disable_export_type_controls(),a(".connection-status").html(r.establishing_remote_connection),a(".connection-status").removeClass("notification-message error-notice migration-error"),a(".connection-status").append(this.ajax_spinner);var i=wpmdb.functions.wpmdb_migration_type(),n=this;a.ajax({url:s,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_verify_connection_to_remote_site",url:t[0],key:t[1],intent:i,nonce:l.nonces.verify_connection_to_remote_site,convert_post_type_selection:wpmdb_convert_post_type_selection,profile:l.profile},error:function(e,t,i){a(".connection-status").html(n.get_ajax_errors(e.responseText,"(#102)",e)),a(".connection-status").addClass("notification-message error-notice migration-error"),a(".ajax-spinner").remove(),n.doing_ajax=!1,n.enable_export_type_controls()},success:function(e){if(a(".ajax-spinner").remove(),n.doing_ajax=!1,n.enable_export_type_controls(),void 0!==e.wpmdb_error&&1===e.wpmdb_error)return a(".connection-status").html(e.body),a(".connection-status").addClass("notification-message error-notice migration-error"),void(e.body.indexOf("401 Unauthorized")>-1&&a(".basic-access-auth-wrapper").show());if(!0!==n.maybe_show_mst_warning(e)){n.maybe_show_ssl_warning(t[0],t[1],e.scheme),wpmdb.functions.maybe_show_prefix_notice(e.prefix),a(".pull-push-connection-info").addClass("temp-disabled"),a(".pull-push-connection-info").attr("readonly","readonly"),a(".connect-button").hide(),a(".connection-status").hide(),a(".step-two").show(),n.connection_established=!0,n.set_connection_data(e),n.move_connection_info_box(),n.maybe_show_mixed_cased_table_name_warning();var i="";!1===wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_tables&&(i=wpmdb_loaded_tables),n.$pull_select=wpmdb.functions.create_table_select(wpmdb.common.connection_data.tables,wpmdb.common.connection_data.table_sizes_hr,i);var o="";!1===wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_post_types&&(void 0!==e.select_post_types?(a("#exclude-post-types").attr("checked","checked"),a(".post-type-select-wrap").show(),o=e.select_post_types):o=wpmdb_loaded_post_types);var s=document.createElement("select");a(s).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types",class:"multiselect"}),a.each(wpmdb.common.connection_data.post_types,function(e,t){var i=a.inArray(t,o);i=-1!==i||!0===wpmdb_convert_exclude_revisions&&"revision"!==t?' selected="selected" ':" ",a(s).append("<option"+i+'value="'+t+'">'+t+"</option>")}),n.$pull_post_type_select=s;var r="";!1===wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_tables_backup&&(r=wpmdb_loaded_tables_backup);var c=document.createElement("select");a(c).attr({multiple:"multiple",name:"select_backup[]",id:"select-backup",class:"multiselect"}),a.each(wpmdb.common.connection_data.tables,function(e,t){var i=a.inArray(t,r);i=-1!==i?' selected="selected" ':" ",a(c).append("<option"+i+'value="'+t+'">'+t+" ("+wpmdb.common.connection_data.table_sizes_hr[t]+")</option>")}),n.$push_select_backup=c,"pull"===wpmdb.functions.wpmdb_migration_type()?(a.wpmdb.do_action("wpmdb_update_pull_table_select"),a("#select-post-types").remove(),a(".exclude-post-types-warning").after(n.$pull_post_type_select),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(n.$pull_select_backup),a(".table-prefix").html(e.prefix),a(".uploads-dir").html(l.this_uploads_dir)):(a("#select-backup").remove(),a(".backup-tables-wrap").prepend(n.$push_select_backup)),a.wpmdb.do_action("verify_connection_to_remote_site",wpmdb.common.connection_data)}else a(".connection-status").hide()}})}}},{key:"migrate_table_recursive",value:function(e,t,i){var n=this,o=i||0;if(o>=this.tables_to_migrate.length)if("upload"===this.stage&&wpmdb.current_migration.model.getStageItems("find_replace").length)this.stage="find_replace",this.tables_to_migrate=wpmdb.current_migration.model.getStageItems("find_replace","name"),this.tables_to_migrate=this.tables_to_migrate.map(function(e){return"_mig_"+e}),o=0;else{if("backup"!==this.stage)return a(".progress-label").removeClass("label-visible"),wpmdb.common.hooks=a.wpmdb.apply_filters("wpmdb_before_migration_complete_hooks",wpmdb.common.hooks),wpmdb.common.hooks.push(wpmdb.functions.migration_complete),wpmdb.common.hooks.push(wpmdb.functions.wpmdb_flush),wpmdb.common.hooks=a.wpmdb.apply_filters("wpmdb_after_migration_complete_hooks",wpmdb.common.hooks),wpmdb.common.hooks.push(wpmdb.functions.migration_complete_events),wpmdb.common.next_step_in_migration={fn:wpmdb.functions.wpmdb_call_next_hook},void wpmdb.functions.execute_next_step();if(-1!==a.inArray(this.migration_intent,["push","pull"])?this.stage="migrate":"import"===this.migration_intent?this.stage="upload":this.stage=this.migration_intent,wpmdb.current_migration.model.setActiveStage(this.stage),"find_replace"!==this.stage&&"migrate"!==this.stage)return void wpmdb.functions.wpmdb_call_next_hook();o=0,this.tables_to_migrate=wpmdb.functions.get_tables_to_migrate(null,null)}var c=0;o===this.tables_to_migrate.length-1&&(c=1);var _=0;-1!==a.inArray(this.migration_intent,["push","pull"])&&1===parseInt(wpmdb.common.connection_data.gzip)&&(_=1);var p={action:"wpmdb_migrate_table",migration_state_id:wpmdb.migration_state_id,table:this.tables_to_migrate[o],stage:this.stage,current_row:e,last_table:c,primary_keys:t,gzip:_,nonce:l.nonces.migrate_table};-1!==a.inArray(this.migration_intent,["push","pull"])&&(p.bottleneck=wpmdb.common.connection_data.bottleneck,p.prefix=wpmdb.common.connection_data.prefix),wpmdb.common.connection_data&&wpmdb.common.connection_data.path_current_site&&wpmdb.common.connection_data.domain&&(p.path_current_site=wpmdb.common.connection_data.path_current_site,p.domain_current_site=wpmdb.common.connection_data.domain),this.doing_ajax=!0,a.ajax({url:s,type:"POST",dataType:"text",cache:!1,timeout:0,data:p,error:function(e,t,i){var a=r.table_process_problem+" "+n.tables_to_migrate[o]+"<br /><br />"+r.status+": "+e.status+" "+e.statusText+"<br /><br />"+r.response+":<br />"+e.responseText;wpmdb.current_migration.setState(r.migration_failed,a,"error"),n.doing_ajax=!1,console.log(e),console.log(t),console.log(i),wpmdb.common.migration_error=!0,wpmdb.functions.migration_complete_events()},success:function(e){n.doing_ajax=!1,e=a.trim(e);var t=wpmdb.functions.wpmdb_parse_json(e),i="";if(!1===t||null===t)return i=""===e||null===e?r.table_process_problem_empty_response+" "+n.tables_to_migrate[o]:n.get_ajax_errors(e,null,null),wpmdb.current_migration.setState(r.migration_failed,i,"error"),wpmdb.common.migration_error=!0,void wpmdb.functions.migration_complete_events();if(void 0!==t.wpmdb_error&&1===t.wpmdb_error)return wpmdb.current_migration.setState(r.migration_failed,t.body,"error"),wpmdb.common.migration_error=!0,void wpmdb.functions.migration_complete_events();var s=n.tables_to_migrate[o];"import"===n.migration_intent&&"find_replace"===n.stage&&(s=s.replace(l.this_temp_prefix,"")),wpmdb.current_migration.setText(),wpmdb.current_migration.model.getStageModel(n.stage).setItemRowsTransferred(s,t.current_row),1===c&&"savefile"===n.migration_intent&&(void 0!==t.dump_filename&&(n.dump_filename=t.dump_filename),void 0!==t.dump_path&&(n.dump_path=t.dump_path)),-1===parseInt(t.current_row)&&(o++,t.current_row="",t.primary_keys=""),wpmdb.common.next_step_in_migration={fn:wpmdb.functions.migrate_table_recursive,args:[t.current_row,t.primary_keys,o]},wpmdb.functions.execute_next_step()}})}},{key:"migration_complete_events",value:function(){if(!1===wpmdb.common.migration_error)if(""===wpmdb.common.non_fatal_errors)if("savefile"!==this.migration_intent&&!0===a("#save_computer").is(":checked")&&wpmdb.current_migration.setText(),this.completed_msg=this.completed_msg+'&nbsp;<div class="dashicons dashicons-yes"></div>',!0===this.migration_cancelled){var e=r.migration_cancelled_success;"find_replace"===this.migration_intent&&(e=r.find_replace_cancelled_success),wpmdb.current_migration.setState(this.completed_msg,e,"cancelled")}else wpmdb.current_migration.setState(this.completed_msg,"","complete");else wpmdb.current_migration.setState(r.completed_with_some_errors,wpmdb.common.non_fatal_errors,"error");a(".migration-controls").addClass("hidden"),wpmdb.common.hooks=[],wpmdb.common.call_stack=[],wpmdb.common.migration_error=!1,this.currently_migrating=!1,this.migration_completed=!0,this.migration_paused=!1,this.migration_cancelled=!1,this.doing_ajax=!1,wpmdb.common.non_fatal_errors="",this.tables_to_migrate=[],a(".progress-label").remove(),a(".migration-progress-ajax-spinner").remove(),a(".close-progress-content").show(),a("#overlay").css("cursor","pointer"),wpmdb.current_migration.model.setMigrationComplete()}},{key:"migration_complete",value:function(){var e=this;if(a(".migration-controls").addClass("hidden"),"savefile"===this.migration_intent){this.currently_migrating=!1;var t=r.migration_complete;if(a("#save_computer").is(":checked")){var i=l.this_download_url+encodeURIComponent(this.dump_filename);a("#gzip_file").is(":checked")&&(i+="&gzip=1"),window.location=i}else t=r.completed_dump_located_at+" "+this.dump_path;!1===wpmdb.common.migration_error&&(wpmdb.functions.migration_complete_events(),wpmdb.current_migration.setState(this.completed_msg,t,"complete"))}else{wpmdb.current_migration.setState(null,r.finalizing_migration,"finalizing");var n={action:"wpmdb_finalize_migration",migration_state_id:wpmdb.migration_state_id,tables:this.tables_to_migrate.join(","),nonce:l.nonces.finalize_migration};-1!==a.inArray(this.migration_intent,["push","pull"])&&(n.prefix=wpmdb.common.connection_data.prefix),this.doing_ajax=!0,a.ajax({url:s,type:"POST",dataType:"text",cache:!1,data:n,error:function(t,i,n){e.doing_ajax=!1,wpmdb.current_migration.setState(r.migration_failed,r.finalize_tables_problem,"error"),alert(t+" : "+i+" : "+n),wpmdb.common.migration_error=!0,wpmdb.functions.migration_complete_events()},success:function(t){if(e.doing_ajax=!1,"1"!==a.trim(t))return wpmdb.current_migration.setState(r.migration_failed,t,"error"),wpmdb.common.migration_error=!0,void wpmdb.functions.migration_complete_events();wpmdb.common.next_step_in_migration={fn:wpmdb.functions.wpmdb_call_next_hook},wpmdb.functions.execute_next_step()}})}}},{key:"wpmdb_flush",value:function(){var e=this;"savefile"!==this.migration_intent&&(wpmdb.current_migration.setText(r.flushing),this.doing_ajax=!0,a.ajax({url:s,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_flush",migration_state_id:wpmdb.migration_state_id,nonce:l.nonces.flush},error:function(t,i,n){e.doing_ajax=!1,wpmdb.current_migration.setState(r.migration_failed,r.flush_problem,"error"),alert(t+" : "+i+" : "+n),wpmdb.common.migration_error=!0,wpmdb.functions.migration_complete_events()},success:function(t){if(e.doing_ajax=!1,"1"!==a.trim(t))return wpmdb.current_migration.setState(r.migration_failed,t,"error"),wpmdb.common.migration_error=!0,void wpmdb.functions.migration_complete_events();wpmdb.common.next_step_in_migration={fn:wpmdb.functions.wpmdb_call_next_hook},wpmdb.functions.execute_next_step()}}))}},{key:"execute_next_step",value:function(){var e=this;if(0<this.delay_between_requests&&!1===this.flag_skip_delay)setTimeout(function(){this.flag_skip_delay=!0,wpmdb.functions.execute_next_step()},this.delay_between_requests);else if(this.flag_skip_delay=!1,!0===this.migration_paused){a(".migration-progress-ajax-spinner").hide(),wpmdb.current_migration.pauseTimer();var t="";!0===this.is_auto_pause_before_finalize?(t=r.paused_before_finalize,this.is_auto_pause_before_finalize=!1,"find_replace"===wpmdb.functions.wpmdb_migration_type()&&(t=r.find_replace_paused_before_finalize)):t=r.paused,wpmdb.current_migration.setState(null,t,"paused"),a("body").on("click",".pause-resume",function(e){this.set_pause_resume_button(e)}),a("body").on("click",".cancel",function(e){this.cancel_migration(e)}),a(".pause-resume").html(r.resume)}else if(!0===this.migration_cancelled){var i;this.migration_intent=wpmdb.functions.wpmdb_migration_type(),"savefile"===this.migration_intent?i=r.removing_local_sql:"pull"===this.migration_intent?i="backup"===this.stage?r.removing_local_backup:r.removing_local_temp_tables:"push"===this.migration_intent&&(i="backup"===this.stage?r.removing_remote_sql:r.removing_remote_temp_tables),wpmdb.current_migration.setText(i);var n={action:"wpmdb_cancel_migration",migration_state_id:wpmdb.migration_state_id,nonce:l.nonces.cancel_migration};this.doing_ajax=!0,a.ajax({url:s,type:"POST",dataType:"text",cache:!1,data:n,error:function(t,i,n){wpmdb.current_migration.setState(r.migration_cancellation_failed,r.manually_remove_temp_files+"<br /><br />"+r.status+": "+t.status+" "+t.statusText+"<br /><br />"+r.response+":<br />"+t.responseText,"error"),console.log(t),console.log(i),console.log(n),e.doing_ajax=!1,wpmdb.common.migration_error=!0,wpmdb.functions.migration_complete_events()},success:function(t){if(e.doing_ajax=!1,t=a.trim(t),"push"===e.migration_intent&&"1"!==t||"push"!==e.migration_intent&&""!==t)return void 0!==t&&void 0!==t.wpmdb_error&&1===t.wpmdb_error&&(t=t.wpmdb_error),wpmdb.current_migration.setState(r.migration_cancellation_failed,t,"error"),wpmdb.common.migration_error=!0,void wpmdb.functions.migration_complete_events();e.completed_msg=r.migration_cancelled,"find_replace"===e.migration_intent&&(e.completed_msg=r.find_replace_cancelled),wpmdb.functions.migration_complete_events(),wpmdb.current_migration.setStatus("cancelled")}})}else wpmdb.common.next_step_in_migration.fn.apply(null,wpmdb.common.next_step_in_migration.args)}},{key:"maybe_show_prefix_notice",value:function(e){var t=a(".prefix-notice");t.hide(),e!==l.this_prefix&&(a(".remote-prefix").html(e),this.show_prefix_notice=!0,t.show())}},{key:"maybe_show_mst_warning",value:function(e){var t=wpmdb.functions.wpmdb_migration_type(),i=!1;return-1!==a.inArray(t,["push","pull"])&&void 0!==e.site_details?l.site_details.is_multisite!==e.site_details.is_multisite&&(void 0!==wpmdb.mst&&void 0!==e.mst_available&&"1"===e.mst_available||(i=!0)):"import"===t&&void 0!==e.multisite&&void 0!==e.subsite_export&&("false"===l.site_details.is_multisite&&"true"===e.multisite&&"true"!==e.subsite_export||"true"===l.site_details.is_multisite&&"false"===e.multisite)&&(i=!0),(i=a.wpmdb.apply_filters("wpmdb_show_mst_warning",i))&&a(".mst-required").show(),i}},{key:"maybe_show_select_table_notice",value:function(){if(a("#migrate-selected").is(":checked")&&null===a("#select-tables").val()){if("import"!==wpmdb.functions.wpmdb_migration_type())return alert(r.please_select_one_table),!0;if(a("#import-find-replace").is(":checked")&&a("#select-tables").is(":visible"))return alert(r.please_select_one_table_import),!0}return!("savefile"===wpmdb.functions.wpmdb_migration_type()||!a("#backup-manual-select").is(":checked")||null!==a("#select-backup").val())&&(alert(r.please_select_one_table_backup),!0)}},{key:"remove_protocol",value:function(e){return e.replace(/^https?:/i,"")}},{key:"create_table_select",value:function(e,t,i){var n=document.createElement("select");return a(n).attr({multiple:"multiple",name:"select_tables[]",id:"select-tables",class:"multiselect"}),0<e.length&&a.each(e,function(e,o){if(!a.wpmdb.apply_filters("wpmdb_exclude_table",!1,o)){var s=" ";void 0!==i&&null!==i&&0<i.length&&-1!==a.inArray(o,i)&&(s=' selected="selected" ');var r="";0!==t.length&&(r=" ("+t[o]+")"),a(n).append("<option"+s+'value="'+o+'">'+o+r+"</option>")}}),n}},{key:"get_tables_to_migrate",value:function(){var e=[],t=wpmdb.functions.wpmdb_migration_type();return"migrate_select"===a("input[name=table_migrate_option]:checked").val()?e=a("#select-tables").val():"pull"!==t&&void 0!==l.this_prefixed_tables?e=l.this_prefixed_tables:"pull"===t&&void 0!==wpmdb.common.connection_data&&void 0!==wpmdb.common.connection_data.prefixed_tables&&(e=wpmdb.common.connection_data.prefixed_tables),e}},{key:"update_migrate_button_text",value:function(){var e=wpmdb.functions.wpmdb_migration_type(),t=a("#save-migration-profile").is(":checked")?"_save":"",i="migrate_button_"+("savefile"===e?"export":e)+t;a(".migrate-db .button-primary").val(r[i])}},{key:"connection_box_changed",value:function(){var e=this,t=a(".pull-push-connection-info");if(-1!==a.inArray(wpmdb.functions.wpmdb_migration_type(),["push","pull"])&&(!this.doing_ajax&&!a(t).hasClass("temp-disabled")||!1!==wpmdb.force_reconnect)){wpmdb.force_reconnect=!1;var i=a(".pull-push-connection-info").val(),n=a.trim(i).split("\n"),o=!1,c="";if(""===n&&(o=!0,c=r.connection_info_missing),1===n.length&&!o){var _=a.trim(i).split(" ");2===_.length&&(n=_)}2===n.length||o||(o=!0,c=r.connection_info_incorrect),o||this.validate_url(n[0])||(o=!0,c=r.connection_info_url_invalid);var p=0;if(void 0!==n[1]&&(p=n[1].length),o||32===p||40===p||(o=!0,c=r.connection_info_key_invalid),o||n[0]!==l.connection_info[0]||(o=!0,c=r.connection_info_local_url),o||n[1]!==l.connection_info[1]||(o=!0,c=r.connection_info_local_key),o)return a(".connection-status").html(c),void a(".connection-status").addClass("notification-message error-notice migration-error");var d=n[0]+"\n"+n[1];1===a.trim(i).split("\n").length&&a(".pull-push-connection-info").val(d),!1===l.openssl_available&&(n[0]=n[0].replace("https://","http://"),d=n[0]+"\n"+n[1],a(".pull-push-connection-info").val(d)),this.show_prefix_notice=!1,this.doing_ajax=!0,this.disable_export_type_controls(),a(".basic-access-auth-wrapper").is(":visible")&&(n[0]=n[0].replace(/\/\/(.*)@/,"//"),n[0]=n[0].replace("//","//"+encodeURIComponent(a.trim(a(".auth-username").val()))+":"+encodeURIComponent(a.trim(a(".auth-password").val()))+"@"),d=n[0]+"\n"+n[1],a(".pull-push-connection-info").val(d),a(".basic-access-auth-wrapper").hide()),a(".step-two").hide(),a(".ssl-notice").hide(),a(".prefix-notice").hide(),a(".connection-status").show(),a(".connection-status").html(r.establishing_remote_connection),a(".connection-status").removeClass("notification-message error-notice migration-error"),a(".connection-status").append(this.ajax_spinner);var m=wpmdb.functions.wpmdb_migration_type();return this.profile_name_edited=!1,a.ajax({url:s,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_verify_connection_to_remote_site",url:n[0],key:n[1],intent:m,nonce:l.nonces.verify_connection_to_remote_site},error:function(t,i,n){a(".connection-status").html(e.get_ajax_errors(t.responseText,"(#100)",t)),a(".connection-status").addClass("notification-message error-notice migration-error"),a(".ajax-spinner").remove(),e.doing_ajax=!1,e.enable_export_type_controls()},success:function(t){if(a(".ajax-spinner").remove(),e.doing_ajax=!1,e.enable_export_type_controls(),void 0!==t.wpmdb_error&&1===t.wpmdb_error)return a(".connection-status").html(t.body),a(".connection-status").addClass("notification-message error-notice migration-error"),t.body.indexOf("401 Unauthorized")>-1&&a(".basic-access-auth-wrapper").show(),void(a(".pull-push-connection-info").hasClass("temp-disabled")||a(".connect-button").is(":visible")||(a(".pull-push-connection-info").removeAttr("readonly"),a(".connect-button").show()));if(!0!==e.maybe_show_mst_warning(t)){e.maybe_show_ssl_warning(n[0],n[1],t.scheme);var i=e.get_domain_name(t.url);a(".create-new-profile").val(i),a(".pull-push-connection-info").addClass("temp-disabled"),a(".pull-push-connection-info").attr("readonly","readonly"),a(".connect-button").hide(),a(".connection-status").hide(),a(".step-two").show(),wpmdb.functions.maybe_show_prefix_notice(t.prefix),e.connection_established=!0,e.set_connection_data(t),e.move_connection_info_box(),e.change_replace_values(),e.maybe_show_mixed_cased_table_name_warning(),e.refresh_table_selects(null,null,e),e.$push_select_backup=a(e.$pull_select).clone(),a(e.$push_select_backup).attr({name:"select_backup[]",id:"select-backup"});var o=document.createElement("select");a(o).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types",class:"multiselect"}),a.each(wpmdb.common.connection_data.post_types,function(e,t){a(o).append('<option value="'+t+'">'+t+"</option>")}),e.$pull_post_type_select=o,a("#new-path-missing-warning, #new-url-missing-warning").hide(),"pull"===wpmdb.functions.wpmdb_migration_type()?(a("#new-url").val(e.remove_protocol(l.this_url)),a("#new-path").val(l.this_path),"true"===l.is_multisite&&(a("#new-domain").val(l.this_domain),a('.replace-row.pin .old-replace-col input[type="text"]').val(e.remove_protocol(t.url))),a("#old-url").val(e.remove_protocol(t.url)),a("#old-path").val(t.path),a.wpmdb.do_action("wpmdb_update_pull_table_select"),a("#select-post-types").remove(),a(".exclude-post-types-warning").after(e.$pull_post_type_select),wpmdb.functions.exclude_post_types_warning(),a(".table-prefix").html(t.prefix),a(".backup-table-prefix").html(l.site_details.prefix),a(".uploads-dir").html(l.this_uploads_dir)):(a("#new-url").val(e.remove_protocol(t.url)),a("#new-path").val(t.path),"true"===l.is_multisite&&a('.replace-row.pin .old-replace-col input[type="text"]').val(e.remove_protocol(l.this_url)),a.wpmdb.do_action("wpmdb_update_push_table_select"),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(e.$push_select_backup)),wpmdb.common.next_step_in_migration={fn:a.wpmdb.do_action,args:["verify_connection_to_remote_site",wpmdb.common.connection_data]},wpmdb.functions.execute_next_step()}else a(".connection-status").hide()}})}}}]),e}();t.default=c},function(e,t){window.jQuery}]);
//# sourceMappingURL=bundle-121.js.map